"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4035],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return u}});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),s=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=s(e.components);return a.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=s(t),u=r,k=m["".concat(c,".").concat(u)]||m[u]||d[u]||o;return t?a.createElement(k,i(i({ref:n},p),{},{components:t})):a.createElement(k,i({ref:n},p))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},49998:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return p},default:function(){return m}});var a=t(87462),r=t(63366),o=(t(67294),t(3905)),i=["components"],l={id:"trading_entry",sidebar_position:1},c="Trading Service Technical View",s={unversionedId:"trading/trading_entry",id:"trading/trading_entry",isDocsHomePage:!1,title:"Trading Service Technical View",description:"Lifecycle Technical information",source:"@site/docs/trading/tradingService.md",sourceDirName:"trading",slug:"/trading/trading_entry",permalink:"/docs/trading/trading_entry",editUrl:"https://github.com/The-Microservice-Dungeon/docs/edit/main/docs/trading/tradingService.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"trading_entry",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Trading Service Overview",permalink:"/docs/trading_entry"},next:{title:"Tradeables (Recources/Items/Upgrades)",permalink:"/docs/trading/tradeables"}},p=[{value:"Lifecycle Technical information",id:"lifecycle-technical-information",children:[]},{value:"Player and Money",id:"player-and-money",children:[]},{value:"Spawns and Spacestations",id:"spawns-and-spacestations",children:[]},{value:"Trading Places",id:"trading-places",children:[]},{value:"Trading Semantics",id:"trading-semantics",children:[{value:"Commands",id:"commands",children:[]}]},{value:"Rest calls for player",id:"rest-calls-for-player",children:[]},{value:"Events for player",id:"events-for-player",children:[{value:"bank-created",id:"bank-created",children:[]},{value:"current-item-prices",id:"current-item-prices",children:[]},{value:"current-resource-prices",id:"current-resource-prices",children:[]},{value:"Trades",id:"trades",children:[]}]},{value:"Rest for other services",id:"rest-for-other-services",children:[]}],d={toc:p};function m(e){var n=e.components,t=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"trading-service-technical-view"},"Trading Service Technical View"),(0,o.kt)("h2",{id:"lifecycle-technical-information"},"Lifecycle Technical information"),(0,o.kt)("p",null,"The processes of the trading service are always based on a user command. This is sent by the player to the game service and from there to the trading service. The trading Service controls the money-relevant information. The service also checks whether the request was made from a valid position (space station). Then, in the case of robot-relevant trades, a single request is sent to the robot service to check whether it meets all the necessary requirements for the trade. If this is the case, the trading service receives a positive response to its request to the robot service, withdraws the money and throws an event with the transactionId associated with the trade, so that the player knows what happened with the trade. In the event of a transaction failure, an event is also thrown to inform the player of the error."),(0,o.kt)("h2",{id:"player-and-money"},"Player and Money"),(0,o.kt)("p",null,"Trading saves a ",(0,o.kt)("inlineCode",{parentName:"p"},"Player"),". The playerId is known, by listening to the Player registered event of the game service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"playerId": "5bc9f935-32f1-4d7b-a90c-ff0e6e34125a",\n"name": "string"\n}\n')),(0,o.kt)("p",null,"Trading is also the only service which saves the money of the registered ",(0,o.kt)("inlineCode",{parentName:"p"},"Player")," as an attribute Money which is a numeric value."),(0,o.kt)("p",null,"(",(0,o.kt)("a",{parentName:"p",href:"https://github.com/The-Microservice-Dungeon/trading/blob/main/src/main/java/dungeon/trading/player/PlayerRestController.java"},"https://github.com/The-Microservice-Dungeon/trading/blob/main/src/main/java/dungeon/trading/player/PlayerRestController.java"),")"),(0,o.kt)("h2",{id:"spawns-and-spacestations"},"Spawns and Spacestations"),(0,o.kt)("p",null,"Even if the trading service is not the owner of the space stations, their positions on the map are still needed and so saved to match the robot position with the positions of the space stations in case of a request to the trading service. For example, if a robot wants to sell resources, but is not located on space station. The data initially comes from the map service which has to emit them as an event for every space station:"),(0,o.kt)("p",null,'{\n"planet_id": "fe9732a9-b905-4934-8835-ed5a93494397"\n}'),(0,o.kt)("p",null,"(",(0,o.kt)("a",{parentName:"p",href:"https://github.com/The-Microservice-Dungeon/trading/blob/main/src/main/java/dungeon/trading/station/StationService.java"},"https://github.com/The-Microservice-Dungeon/trading/blob/main/src/main/java/dungeon/trading/station/StationService.java"),")"),(0,o.kt)("h2",{id:"trading-places"},"Trading Places"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"PLAYER")," can buy ",(0,o.kt)("inlineCode",{parentName:"p"},"SPECIAL ITEM")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"UPGRADES")," with a ",(0,o.kt)("inlineCode",{parentName:"p"},"ROBOT")," at ",(0,o.kt)("inlineCode",{parentName:"p"},"SPACESTATION"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"PLAYER")," can buy ",(0,o.kt)("inlineCode",{parentName:"p"},"ROBOTS")," ",(0,o.kt)("strong",{parentName:"p"},"EVERYWHERE")," which spawns at a random ",(0,o.kt)("inlineCode",{parentName:"p"},"SPACESTATION"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"RESOURCE")," can be sold at any ",(0,o.kt)("inlineCode",{parentName:"p"},"SPACESTATION")))),(0,o.kt)("h2",{id:"trading-semantics"},"Trading Semantics"),(0,o.kt)("h3",{id:"commands"},"Commands"),(0,o.kt)("p",null,"For a deep dive on commands please look here: ",(0,o.kt)("a",{parentName:"p",href:"/docs/game/commands"},"Commands")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"gameId": "d290f1ee-6c54-4b01-90e6-d701748f0851",\n"playerToken": "d290f1ee-6c54-4b01-90e6-d701748f0851",\n"robotId": "d290f1ee-6c54-4b01-90e6-d701748f0851",\n"commandType": "blocking",\n"commandObject": \n    {\n    "commandType": "blocking",\n    "planetId": "d290f1ee-6c54-4b01-90e6-d701748f0851",\n    "targetId": "d290f1ee-6c54-4b01-90e6-d701748f0851",\n    "itemName": "string",\n    "itemQuantity": 5\n    }\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"(",(0,o.kt)("a",{parentName:"li",href:"https://github.com/The-Microservice-Dungeon/game/blob/main/src/main/kotlin/microservice/dungeon/game/aggregates/command/controller/CommandController.kt"},"https://github.com/The-Microservice-Dungeon/game/blob/main/src/main/kotlin/microservice/dungeon/game/aggregates/command/controller/CommandController.kt"),")"),(0,o.kt)("li",{parentName:"ul"},"(",(0,o.kt)("a",{parentName:"li",href:"https://github.com/The-Microservice-Dungeon/game/blob/main/src/main/kotlin/microservice/dungeon/game/aggregates/command/domain/Command.kt"},"https://github.com/The-Microservice-Dungeon/game/blob/main/src/main/kotlin/microservice/dungeon/game/aggregates/command/domain/Command.kt"),")"),(0,o.kt)("li",{parentName:"ul"},"(",(0,o.kt)("a",{parentName:"li",href:"https://github.com/The-Microservice-Dungeon/game/blob/main/src/main/kotlin/microservice/dungeon/game/aggregates/command/domain/CommandPayload.kt"},"https://github.com/The-Microservice-Dungeon/game/blob/main/src/main/kotlin/microservice/dungeon/game/aggregates/command/domain/CommandPayload.kt"),")")),(0,o.kt)("h2",{id:"rest-calls-for-player"},"Rest calls for player"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"For the ",(0,o.kt)("inlineCode",{parentName:"li"},"player")," there are ",(0,o.kt)("strong",{parentName:"li"},"no relevant")," REST calls to the trading service")),(0,o.kt)("h2",{id:"events-for-player"},"Events for player"),(0,o.kt)("h3",{id:"bank-created"},"bank-created"),(0,o.kt)("p",null,"This event is produced when a player bank account is initialized:"),(0,o.kt)("p",null,"Channel: ",(0,o.kt)("strong",{parentName:"p"},"bank-created")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"playerId": "35184259-d156-4290-94ed-3a4b4f2c36f8",\n"money": 0\n}\n')),(0,o.kt)("h3",{id:"current-item-prices"},"current-item-prices"),(0,o.kt)("p",null,"At the beginning of each round the new item buy-prices are announced"),(0,o.kt)("p",null,"Channel: ",(0,o.kt)("strong",{parentName:"p"},"current-item-prices")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[\n{\n    "name": "string", <- Item name\n    "price": 0\n}\n]\n')),(0,o.kt)("h3",{id:"current-resource-prices"},"current-resource-prices"),(0,o.kt)("p",null,"At the beginning of each round the new sell-resources prices are announced"),(0,o.kt)("p",null,"Channel: ",(0,o.kt)("strong",{parentName:"p"},"current-resource-prices")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[\n    {\n    "name": "string",\n    "price": 0\n    }\n]\n')),(0,o.kt)("h3",{id:"trades"},"Trades"),(0,o.kt)("p",null,"The event which indicates what happened to the trade. It also contains additional data about the result of the trade in data. For example, if a robot was bought, data contains the new robot object."),(0,o.kt)("p",null,"Channel: ",(0,o.kt)("strong",{parentName:"p"},"trades")),(0,o.kt)("h4",{id:"headers"},"Headers"),(0,o.kt)("p",null,"There are four kinds of ",(0,o.kt)("inlineCode",{parentName:"p"},"headers"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"buy-error"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"type": "buy-error",\n"eventId": "5bc9f935-32f1-4d7b-a90c-ff0e6e34125a",\n"version": 42,\n"timestamp": "2020-01-10T12:00:00Z"\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"buy-robot"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"type": "buy-robot",\n"eventId": "5bc9f935-32f1-4d7b-a90c-ff0e6e34125a",\n"version": 42,\n"timestamp": "2020-01-10T12:00:00Z"\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"buy-item"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"type": "buy-item",\n"eventId": "5bc9f935-32f1-4d7b-a90c-ff0e6e34125a",\n"version": 42,\n"timestamp": "2020-01-10T12:00:00Z"\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"sell-resource"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"type": "sell-resource",\n"eventId": "5bc9f935-32f1-4d7b-a90c-ff0e6e34125a",\n"version": 42,\n"timestamp": "2020-01-10T12:00:00Z"\n}\n')),(0,o.kt)("h4",{id:"payloads"},"Payloads"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"failed transaction"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"success": false,\n"moneyChangedBy": 0,\n"message": "not enough money",\n"data": null\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"bought-robot"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"success": true,\n"moneyChangedBy": -500,\n"message": "robot bought",\n"data": [\n    {\n    "id": "497f6eca-6276-4993-bfeb-53cbbbba6f08",\n    "player": "ae2cfcf0-e870-4360-a41e-3b3bb3312234",\n    "planet": "2faf337d-d8d1-40fc-983e-5f130540496b",\n    "alive": true,\n    "maxHealth": 100,\n    "maxEnergy": 60,\n    "energyRegen": 8,\n    "attackDamage": 5,\n    "miningSpeed": 10,\n    "health": 75,\n    "energy": 43,\n    "healthLevel": 5,\n    "damageLevel": 5,\n    "miningSpeedLevel": 5,\n    "miningLevel": 5,\n    "energyLevel": 5,\n    "energyRegenLevel": 5,\n    "storageLevel": 5,\n    "inventory": {\n        "maxStorage": 20,\n        "usedStorage": 5,\n        "storedCoal": 3,\n        "storedIron": 2,\n        "storedGem": 0,\n        "storedGold": 0,\n        "storedPlatin": 0\n    },\n    "items": {\n        "rocket": 0,\n        "wormhole": 2,\n        "longRangeBombardement": 0,\n        "selfDestruction": 1,\n        "repairSwarm": 0,\n        "nuke": 3\n    }\n    }\n]\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"bought item"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"success": true,\n"moneyChangedBy": -100,\n"message": "item bought",\n"data": null\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"sold resources"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"success": true,\n"moneyChangedBy": 1337,\n"message": "resources sold",\n"data": {\n    "coal": 3,\n    "iron": 2,\n    "gem": 0,\n    "gold": 0,\n    "platin": 0\n}\n}\n')),(0,o.kt)("h2",{id:"rest-for-other-services"},"Rest for other services"),(0,o.kt)("p",null,"The trading service is receiving the ",(0,o.kt)("inlineCode",{parentName:"p"},"commands")," from the game service via REST call."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"POST"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    http://{defaultHost}/commands\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"example payload"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[\n    {\n    "transactionId": "transactionId",\n    "playerId": "playerId",\n    "payload": \n\n        {\n            "commandType": "buy",\n            "amount": "5",\n            "itemName": "ROBOT"\n        }\n    }\n\n]\n')),(0,o.kt)("p",null,"The gameLog service is using a get command to receive the current balances of the ",(0,o.kt)("inlineCode",{parentName:"p"},"players")," bank accounts."),(0,o.kt)("p",null,"For the current round:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"GET"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    http://{defaultHost}/balances\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"example payload"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[\n\n    {\n        "playerId": "35184259-d156-4290-94ed-3a4b4f2c36f8",\n        "balance": 30002\n    }\n\n]\n')),(0,o.kt)("p",null,"Or for a specific round"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"GET"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    http://{defaultHost}/balances/{round-number}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"example payload"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[\n\n    {\n        "round": 0,\n        "playerId": "35184259-d156-4290-94ed-3a4b4f2c36f8",\n        "balance": 30002\n    }\n\n]\n')))}m.isMDXComponent=!0}}]);